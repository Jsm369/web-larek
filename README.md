# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run serve
```

или

```
yarn
yarn serve
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Используется шаблон архитектуры MVP(Model View Presenter). Поэтому приложение будет разделено на 3 слоя:
  1. Модель(Model)
      - `Содержит данные и бизнес-логику приложения`
      - `Предоставляет методы для доступа, изменения и обработки данных`
  2. Представление(View)
      - `Отвечает за отображение данных пользователю и взаимодействие с пользовательским интерфейсом`\
      - `Подписывается на изменения данных в модели(model) и обновляет свой интерфейс в соответствии с этими изменениями`
  3. Презентер(Presenter)
      - `Служит посредником между моделью(model) и представлением(view)`\
      - `Обновляет представление(view), уведомляя его о изменениях в модели(model)`

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов\
\
`constructor(baseUrl: string, options: RequestInit = {})` - Конструктор класса принимает поля `baseUrl` - по которому будут совершаться запросы и `options` - отвечает за дополнительные настройки для этих запросов\
\
Поля: 
- `baseUrl: string` - Хранит базовый URL, к которому будут добавляться относительные URI для формирования полного URL запроса
- `options: RequestInit = {}` - Объект, содержащий настройки для HTTP запросов

Методы:
- `handleResponse`(protected) - используется для обработки ответа от сервера после выполнения HTTP запроса
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий\
\
`constructor()` - Конструктор класса инициализирует брокер событий\
\
Поля:
- `this._events = new Map<EventName, Set<Subscriber>>()` - используется для хранения информации о событиях и их подписчиках

Методы:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс Component`<T>`
Абстрактный класс, который отвечает за создание пользовательского интерфейса\
\
`constructor(protected readonly container: HTMLElement)`(protected) - Конструктор класса принимает параметр в который будет рендериться компонент\
\
Поля:
- `container: HTMLElement`(protected) - параметр используемый для хранения ссылки на корневой элемент DOM, в который будет рендериться компонент

Методы:
- `toggleClass` - переключение класса
- `setText`(protected) - устанавливает текстовое содержимое
- `setDisabled` - меняет статус блокировки
- `setHidden`(protected) - скрывает элемент
- `setVisible`(protected) - показывает элемент
- `setImage`(protected) - устанавливает изображение с альтернативным текстом
- `render` - возвращает обновленный контейнер компонента 

#### Класс Model`<T>`
Абстрактный класс, в котором хранятся данные, для последующей передачи\
\
`constructor(data: Partial<T>, protected events: IEvents)` - Конструктор класса инициализирует экземпляр модели и устанавливает объект для управления событиями\
\
Поля:
- `data: Partial<T>` - данные типа T, которые инициализируют поля модели при создании
- `events: IEvents`(protected) - предоставляет методы для работы с событиями

Метод: 
- `emitChanges` - сообщает о изменении модели

#### Класс larekAPI
Класс, предназначен для взаимодействия с API  приложения
Выполняет роль расширения класса API\
\
`constructor(cdn: string, baseUrl: string, options?: RequestInit)` - Конструктор вызывает конструктор родительского класса Api с параметрами baseUrl и options, затем инициализирует поле cdn \
\
Поля:
- `cdn: string` - Базовый URL для CDN
- `baseUrl` - Базовый URL для API
- `options`(не обязтельный) - дополнительные параметры для настройки запросов

Методы:
- `getProductList()` - возвращает список продуктов с обновленными URL для изображений
- `getProductItem(id: string)` - возвращает информацию о конкретном продукте по его идентификатору с обновленным URL для изображения
- `postOrder(order: IFullOrder)` - отправляет заказ и возвращает статус заказа

#### Класс Form`<T>`
Класс, нужный для управления интерактивности формы\
\
`constructor(protected container: HTMLFormElement, protected events: IEvents)` - Конструктор класса управляет событиями формы и их обработкой \
\
Поля: 
- `container: HTMLFormElement`(protected) - элемент формы, в который будет рендериться компонент
- `events: IEvents`(protected) - объект, реализующий интерфейс, для управления событиями
- `_submit: HTMLButtonElement`(protected) - элемент кнопки формы
- `_errors: HTMLElement`(protected) - элемент с сообщением ошибки 

Сеттеры:
- `set valid(value: boolean)` - управляет доступность кнопки(если true то кнопка станет доступной)
- `set errors(value: boolean)` - устанавлияет текст ошибки для пользователя\

Методы:
- `onInputChange`(protected) - событие при изменении значений в полях формы
- `render` - обновляет состояние формы

#### Класс Contacts
Класс отвечает за управление инпутами телефона и email.\
Выполняет роль расширения класса Form\
\
`constructor(container: HTMLFormElement, events: IEvents)` - Конструктор класса обеспечивает методы для управления событиями в форме, и передачи их в конструктор родительского класса\
\
Поля:
- `container: HTMLFormElement` - элемент формы, к которому будет привязан компонент Contacts
- `events: IEvents` - объект типа IEvents, предоставляющий методы для управления событиями в форме

Сеттеры:
- `set phone && email` - устанавливают значения в инпуты формы

#### Класс Order
Класс отвечает за управление инпутом адресса и выбором метода оплаты\
Выполняет роль расширения класса Form\
\
`constructor(container: HTMLFormElement, events: IEvents)` - Конструктор класса обеспечивает методы для управления событиями в форме, и передачи их в конструктор родительского класса\
\
Поля:
- `container: HTMLFormElement` - элемент формы, к которому будет привязан компонент Order
- `events: IEvents` - объект типа IEvents, предоставляющий методы для управления событиями в форме
- `_payments: HTMLButtonElement[]`(protected) - массив кнопок, которые используются для выбора метода оплаты
- `_paymentMethods: PayMethod = PayMethod.CARD`(protected) - текущий выбранный метод оплаты
- `_address: HTMLInputElement`(protected) - инпут для ввода адреса доставки

Сеттеры:
- `set adress(value: string)` - устанавливает значение в инпут адреса в форме
- `set payment(name: string)` - управляет активным состоянием кнопок выбора способа оплаты

### Компоненты модели данных

#### Класс AppData
Класс для реализация работы с моделью приложения \
Наследуется от класса Model<IAppData>\

Поля:
- `products: IProduct[]` - массив продуктов, представляющих каталог приложения
- `details: IProduct | null` - данные о выбранном продукте, может быть null, если продукт не выбран
- `basket: IProduct[] = []` - массив продуктов, представляющих корзину покупок. Инициализируется пустым массивом по умолчанию
- `order: IOrder` - объект текущего заказа, содержащий информацию о заказе
- `formErrors: Partial<Record<keyof IOrder, string>>` - объект для хранения ошибок валидации формы заказа

Методы:
- `loadBasketFromStorage()` - загружает корзину из локального хранилища
- `saveBasketToStorage()`(private) - сохраняет текущую корзину в локальное хранилище
- `addToBasket(product: IProduct)` - добавляет в корзину
- `removeFromBasket(product: IProduct)` - удаляет из корзины
- `clearBasket()` - очищает корзину
- `isInBasket(product: IProduct): boolean` - проверяет, находится ли товар в корзине
- `getBasketLength(): number` - получает кол-во элементов в корзине
- `getTotalPrice(): number` - получает общую стоимость корзины
- `setPaymentMethod(paymentMethod: PayMethod)` - устанавливает метод оплаты для заказа
- `updateOrderField(field: keyof IOrder, value: string | PayMethod)` - обновляет поле заказа значением value, если поле - это метод оплаты, вызывает метод setPaymentMethod
- `validateOrderForm()` - валидирует форму заказа
- `validateContactsForm()` - валидирует форму контактных данных заказа
- `clearOrder()` - очищает текущий заказ, сбрасывая все поля к значениям по умолчанию
- `setProducts(items: IProduct[])` - устанавливает список товаров
- `setProductDetails(item: IProduct)` - устанавливает детали выбранного товара

### Классы представления

#### Класс Page
Класс который отвечает за управление различными элементами страницы и ее поведением\
Выполняет роль расширения класса Component\
\
`constructor(container: HTMLElement, protected events: IEvents)` - Конструктор класса инициализирует объект страницы, который наследует функционал компонента Component<IPage>\
\
Поля:
- `container: HTMLElement` - элемент контейнера страницы, к которому будет привязан компонент Page
- `events: IEvents` - объект типа IEvents, предоставляющий методы для управления событиями компонента
- `_counter: HTMLElement`(protected) - элемент счетчика корзины
- `_catalog: HTMLElement`(protected) - элемент каталога продуктов
- `_wrapper: HTMLElement`(protected) - обертка страницы
- `_basket: HTMLElement`(protected) - элемент корзины

Сеттеры:
- `set counter(value: number)` - устанавливает значение счетчика корзины
- `set catalog(items: HTMLElement[])` - управляет содержимым каталога, заменяет текущие дочерние элементы новыми
- `set locked(value: boolean)` - управляет состоянием блокировки страницы

#### Класс Basket
Класс который отвечает за отображение и управления корзиной\
Выполняет роль расширения класса Component\
\
`constructor(container: HTMLElement, protected events: EventEmitter)` - Конструктор класса обеспечивает инициализацию необходимых элементов DOM и установку обработчика событий для кнопки оформления заказа\
\
Поля:
- `container: HTMLElement` - элемент контейнера корзины, к которому будет привязан компонент Basket
- `events: EventEmitter`(protected) - объект типа EventEmitter, предоставляющий методы для управления событиями компонента
- `_list: HTMLElement`(protected) -  элемент списка товаров в корзине 
- `_total: HTMLElement`(protected) - элемент для отображения общей суммы заказа
- `_button: HTMLElement`(protected) - элемент кнопки оформления заказа

Сеттеры:
- `set items(items: HTMLElement[])` - устанавливает элементы товаров в корзине и устанавливает доступность кнопки
- `set total(total: number)` - устанавливает общую сумму заказа в корзине

#### Класс Modal 
Класс представляющий собой компонент модального окна\
Выполняет роль расширения класса Component\
\
`constructor(container: HTMLElement, protected events: IEvents)` - Конструктор класса инициализирует модальное окно, принимая элемент контейнера и объект событий\
\
Поля: 
- `container: HTMLElement` - элемент контейнера модального окна, к которому будет привязан компонент Modal
- `events: IEvents`(protected) - объект типа IEvents, предоставляющий методы для управления событиями компонента
- `_closeButton: HTMLButtonElement`(protected) - элемент кнопки закрытия модального окна 
- `_content: HTMLElement`(protected) - элемент контента модального окна 

Сеттеры:
- `set content(value: HTMLElement)` - устанавливает содержимое модального окна

Методы:
- `open` - открывает модальное окно путем добавления класса
- `close` - закрывает модальное окно путем удаления класса
- `render` - возвращает контейнер модального окна

#### Класс Card
Класс представляет компонент карточки продукта на веб-странице\
Выполняет роль расширения класса Component\
\
`constructor(container: HTMLElement, actions?: ICardActions)` - Конструктор класса инициализирует карточку товара с необходимыми элементами и обработчиком действия\
\
Поля:
- `container: HTMLElement` - элемент контейнера для карточки товара
- `actions?: ICardActions` - опциональный объект, содержащий действия, которые могут быть связаны с карточкой товара
- `_title: HTMLElement`(protected) - элемент заголовка карточки товара 
- `_image?: HTMLImageElement`(protected) - опциональный элемент изображения карточки товара
- `_price: HTMLElement`(protected) - элемент, отображающий цену товара
- `_category?: HTMLElement`(protected) - опциональный элемент, отображающий категорию товара
- `_description?: HTMLElement`(protected) - опциональный элемент, отображающий описание товара
- `_button?: HTMLButtonElement`(protected) - опциональный элемент кнопки действия на карточке товара

Сеттеры и Геттеры: 
- `set id(value: string) && get id(): string` - устанавливает и получает идентификатор карточки
- `set title(value: string) && get title(): string` - устанавливает и получает заголовок карточки.
- `set image(value: string)` - устанавливает изображение карточки и связанный с ним текст
- `set price(value: string) && get price(): string` - устанавливает и получает цену продукта, также управляет доступностью кнопки 
- `set category(value: string) && get category(): string` - устанавливает и получает категорию продукта, также добавляя класс из объекта
- `set description(value: string) && get description(): string` - устанавливает и получает описание продукта
- `set button(value: string)` - устанавливает текст на кнопке

#### Класс SuccessOrder
Класс представляет компонент успешного завершения заказа
Выполняет роль расширения класса Component\
\
`constructor(
		protected container: HTMLFormElement,
		protected events: IEvents,
		protected action: ISuccessOrderAction
	)` - отвечает за инициализацию компонента успешного завершения заказа
\
Поля:
- `container: HTMLFormElement`(protected) - элемент контейнера для карточки товара
- `events: IEvents`(protected) - объект типа IEvents, предоставляющий методы для управления событиями компонента
- `action: ISuccessOrderAction`(protected) - содержит действия для компонента, включая функцию onClick для кнопки закрытия
- `_closeButton: HTMLButtonElement`(protected) - элемент кнопки закрытия окна
- `_total: HTMLElement`(protected) -  элемент, который будет отображать общую сумму списанных средств

Сеттеры:
- `set total(value: number)` - устанавливает текст в элементе _total для отображения общей суммы списанных средств.

### События 
- `modal:open` - открывает модальное окно
- `modal:close` - закрывает модальное окно
- `card:select` - выбирает карточку товара для дальнейшего взаимодействия
- `items:changed` - изменяет список товаров в каталоге
- `basket:open` - открывает корзину в модальном окне
- `basket:update` - обновляет содержимое корзины
- `order:open` - открывает форму для оформления заказа
- `order.*:change` - изменяет значения всех полей в форме заказа 
- `contacts.*:change` - изменяет значения всех полей в форме контактных данных
- `orderFormErrors:change` - изменяет ошибки, связанные с формой заказа
- `contactsFormErrors:change` - изменяет ошибки, связанные с формой контактных данных
- `order:submit` - отправляет данные заказа для проверки и перехода к заполнению контактных данных
- `contacts:submit` - отправляет контактные данные для оформления заказа

### Типы и Интерфесы
- `IAppData` - описывает основные данные приложения
  - `products: IProduct[]` - массив объектов IProduct, представляющих товары, доступные в приложении
  - `basket: IProduct[]` - массив, представляющий товары в корзине пользователя
  - `order: IFullOrder | null` - содержит информацию о текущем заказе пользователя или null, если заказ не создан
 
- `enum PayMethod` - перечисление, определяющее возможные методы оплаты CASH или CARD
    
- `IProduct` - описывает структуру продукта
  - `id:string` - уникальный идентификатор товара
  - `description: string` - описание или детали товара
  - `image: string` - URL или путь к изображению товара
  - `title: string` - название товара
  - `category: string` - категория, к которой относится товар
  - `price: number`- цена товара
    
- `IBasket` - описывает интерфейс корзины
  - `items: IProduct[]` - массив объектов IProduct, представляющих товары в корзине
  - `totalPrice: number` - общая стоимость всех товаров в корзине
 
- `IFullOrder` - описывает интерфейс всего заказа, наследует поля из интерфейсов IOrderForm и IContactsForm
  - `items: string[]` - массив id продуктов
  - `total: number` - общая стоимость заказа
    
- `IOrder` - описывает данные о заказе, наследует поля из интерфейсов IOrderForm и IContactsForm

- `IOrderForm` - описывате данные в форме оформления заказа
  - `address: string` - адрес доставки заказа
  - `payment: PayMethod` - метод оплаты заказа
    
- `IContactsForm` - описывате контактные данные в форме оформления заказа
  - `phone: string` - номер телефона клиента
  - `email: string` - адрес электронной почты клиента
    
- `IOrderStatus` - описывает структуру заказа
  - `status: string` - состояние заказа
  - `totalPrice: number` - общая стоимость заказа

#### Utils/constants 
- `settings` - объект с категориями для сортировки
- `emailRegex, phoneRegex, addressRegex` - регулярные выражения для проверки форматов email, телефонного номера и адреса
- `BasketStorageKey` - ключ для сохранения данных корзины в локальном хранилище

### Утилилиты для работы с локальным хранилищем
- `saveToLocalStorage<T>` - функция сохраняет значение в локальное хранилище под указанным ключом
- `loadFromLocalStorage<T>` - функция загружает значение из локального хранилища по указанному ключу
  

